<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>WebGL Black Hole</title>
        <link rel="stylesheet" href="./style.css">
        
        <!-- Open Graph -->
        <meta itemprop="name" content="WebGL Black Hole">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="https://webgl-black-hole.vercel.app/social/share-1200x630.png">

        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="WebGL Black Hole">
        <meta name="twitter:description" content="">
        <meta name="twitter:image" content="https://webgl-black-hole.vercel.app/social/share-1200x600.png">

        <meta property="og:site_name" content="WebGL Black Hole">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://webgl-black-hole.vercel.app">
        <meta property="og:title" content="WebGL Black Hole">
        <meta property="og:description" content="">
        <meta property="og:image" content="https://webgl-black-hole.vercel.app/social/share-1200x630.png">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
        
        <!-- Three.js CDN -->
        <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
        <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.141.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.141.0/examples/jsm/",
                "lil-gui": "https://unpkg.com/lil-gui@0.16.1/dist/lil-gui.esm.js",
                "stats.js": "https://unpkg.com/stats.js@0.17.0/build/stats.min.js"
            }
        }
        </script>
    </head>
    <body>
        <div class="experience"></div>

        <div class="credits">
            WebGL Black Hole by <a href="#" target="_blank">Rilker Andrade</a> (<a href="https://github.com/brunosimon/webgl-black-hole" target="_blank">Source code</a>)
        </div>

        <script type="module">
            console.log('Iniciando simulação do buraco negro...');
            
            try {
                // Importar Three.js
                const THREE = await import('three');
                console.log('Three.js carregado com sucesso');
                
                // Configurações
                const config = {
                    pixelRatio: Math.min(Math.max(window.devicePixelRatio, 1), 2),
                    width: window.innerWidth,
                    height: window.innerHeight
                };
                
                // Cenas
                const scenes = {
                    space: new THREE.Scene(),
                    distortion: new THREE.Scene(),
                    overlay: new THREE.Scene()
                };
                
                // Câmera
                const camera = new THREE.PerspectiveCamera(75, config.width / config.height, 0.1, 1000);
                camera.position.z = 5;
                
                // Renderer
                const renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true 
                });
                renderer.setSize(config.width, config.height);
                renderer.setPixelRatio(config.pixelRatio);
                renderer.setClearColor(0x000000, 1);
                document.querySelector('.experience').appendChild(renderer.domElement);
                
                // Criar buraco negro
                const blackHoleGeometry = new THREE.PlaneGeometry(4, 4);
                const blackHoleMaterial = new THREE.ShaderMaterial({
                    vertexShader: `
                        varying vec2 vUv;
                        void main() {
                            vUv = uv;
                            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                        }
                    `,
                    fragmentShader: `
                        uniform float time;
                        varying vec2 vUv;
                        
                        void main() {
                            vec2 uv = vUv - 0.5;
                            float dist = length(uv);
                            
                            // Efeito de distorção
                            float distortion = 1.0 / (1.0 + dist * 10.0);
                            
                            // Cor do buraco negro
                            vec3 color = vec3(0.0);
                            
                            // Disco de acreção
                            if(dist > 0.3 && dist < 0.8) {
                                float angle = atan(uv.y, uv.x);
                                float spiral = sin(angle * 8.0 + time * 2.0) * 0.5 + 0.5;
                                color = vec3(0.8, 0.2, 0.8) * spiral * distortion;
                            }
                            
                            // Partículas estelares
                            float stars = sin(uv.x * 100.0 + time) * sin(uv.y * 100.0 + time * 0.5);
                            stars = max(0.0, stars - 0.8) * 5.0;
                            color += vec3(stars);
                            
                            gl_FragColor = vec4(color, 1.0);
                        }
                    `,
                    uniforms: {
                        time: { value: 0 }
                    }
                });
                
                const blackHole = new THREE.Mesh(blackHoleGeometry, blackHoleMaterial);
                scenes.space.add(blackHole);
                
                // Adicionar partículas estelares
                const starsGeometry = new THREE.BufferGeometry();
                const starsCount = 1000;
                const starsPositions = new Float32Array(starsCount * 3);
                
                for(let i = 0; i < starsCount * 3; i += 3) {
                    starsPositions[i] = (Math.random() - 0.5) * 20;
                    starsPositions[i + 1] = (Math.random() - 0.5) * 20;
                    starsPositions[i + 2] = (Math.random() - 0.5) * 20;
                }
                
                starsGeometry.setAttribute('position', new THREE.BufferAttribute(starsPositions, 3));
                
                const starsMaterial = new THREE.PointsMaterial({
                    color: 0xffffff,
                    size: 0.05,
                    transparent: true,
                    opacity: 0.8
                });
                
                const stars = new THREE.Points(starsGeometry, starsMaterial);
                scenes.space.add(stars);
                
                // Animação
                let time = 0;
                function animate() {
                    requestAnimationFrame(animate);
                    time += 0.01;
                    
                    // Atualizar uniformes
                    blackHoleMaterial.uniforms.time.value = time;
                    
                    // Rotação das estrelas
                    stars.rotation.y += 0.001;
                    
                    // Renderizar
                    renderer.render(scenes.space, camera);
                }
                
                animate();
                console.log('Simulação do buraco negro iniciada com sucesso!');
                
                // Responsividade
                window.addEventListener('resize', () => {
                    config.width = window.innerWidth;
                    config.height = window.innerHeight;
                    
                    camera.aspect = config.width / config.height;
                    camera.updateProjectionMatrix();
                    
                    renderer.setSize(config.width, config.height);
                });
                
            } catch (error) {
                console.error('Erro ao carregar simulação:', error);
                document.querySelector('.experience').innerHTML = '<div style="color: white; text-align: center; padding: 50px; font-family: Arial, sans-serif;">Erro ao carregar a simulação do buraco negro: ' + error.message + '</div>';
            }
        </script>
    </body>
</html>