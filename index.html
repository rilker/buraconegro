<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>WebGL Black Hole</title>
        <link rel="stylesheet" href="./style.css">
        
        <!-- Open Graph -->
        <meta itemprop="name" content="WebGL Black Hole">
        <meta itemprop="description" content="">
        <meta itemprop="image" content="https://webgl-black-hole.vercel.app/social/share-1200x630.png">

        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="WebGL Black Hole">
        <meta name="twitter:description" content="">
        <meta name="twitter:image" content="https://webgl-black-hole.vercel.app/social/share-1200x600.png">

        <meta property="og:site_name" content="WebGL Black Hole">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://webgl-black-hole.vercel.app">
        <meta property="og:title" content="WebGL Black Hole">
        <meta property="og:description" content="">
        <meta property="og:image" content="https://webgl-black-hole.vercel.app/social/share-1200x630.png">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
        
        <!-- Three.js CDN -->
        <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
        <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.141.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.141.0/examples/jsm/",
                "lil-gui": "https://unpkg.com/lil-gui@0.16.1/dist/lil-gui.esm.js",
                "stats.js": "https://unpkg.com/stats.js@0.17.0/build/stats.min.js"
            }
        }
        </script>
    </head>
    <body>
        <div class="experience"></div>

        <div class="credits">
            WebGL Black Hole by <a href="#" target="_blank">Rilker Andrade</a> (<a href="https://github.com/brunosimon/webgl-black-hole" target="_blank">Source code</a>)
        </div>

        <script type="module">
            console.log('Carregando simulação original do buraco negro...');
            
            try {
                // Importar Three.js
                const THREE = await import('three');
                console.log('Three.js carregado');
                
                // Configurações
                const config = {
                    pixelRatio: Math.min(Math.max(window.devicePixelRatio, 1), 2),
                    width: window.innerWidth,
                    height: window.innerHeight
                };
                
                // Cenas
                const scenes = {
                    space: new THREE.Scene(),
                    distortion: new THREE.Scene(),
                    overlay: new THREE.Scene()
                };
                
                // Câmera
                const camera = new THREE.PerspectiveCamera(75, config.width / config.height, 0.1, 1000);
                camera.position.z = 5;
                
                // Renderer
                const renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true 
                });
                renderer.setSize(config.width, config.height);
                renderer.setPixelRatio(config.pixelRatio);
                renderer.setClearColor(0x000000, 1);
                document.querySelector('.experience').appendChild(renderer.domElement);
                
                // Shader do buraco negro original
                const blackHoleVertexShader = `
                    varying vec2 vUv;
                    void main() {
                        vUv = uv;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `;
                
                const blackHoleFragmentShader = `
                    uniform float time;
                    uniform float uIntensity;
                    uniform vec2 uMouse;
                    varying vec2 vUv;
                    
                    // Função de ruído
                    float random(vec2 st) {
                        return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
                    }
                    
                    float noise(vec2 st) {
                        vec2 i = floor(st);
                        vec2 f = fract(st);
                        
                        float a = random(i);
                        float b = random(i + vec2(1.0, 0.0));
                        float c = random(i + vec2(0.0, 1.0));
                        float d = random(i + vec2(1.0, 1.0));
                        
                        vec2 u = f * f * (3.0 - 2.0 * f);
                        
                        return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
                    }
                    
                    void main() {
                        vec2 uv = vUv - 0.5;
                        float dist = length(uv);
                        
                        // Efeito de distorção do buraco negro
                        float distortion = 1.0 / (1.0 + dist * 15.0);
                        distortion = pow(distortion, 2.0);
                        
                        // Cor base do buraco negro
                        vec3 color = vec3(0.0);
                        
                        // Disco de acreção
                        if(dist > 0.2 && dist < 0.9) {
                            float angle = atan(uv.y, uv.x);
                            float spiral = sin(angle * 12.0 + time * 3.0) * 0.5 + 0.5;
                            spiral *= sin(angle * 6.0 - time * 2.0) * 0.5 + 0.5;
                            
                            // Gradiente de cores
                            vec3 accretionColor = mix(
                                vec3(0.8, 0.1, 0.8), // Roxo
                                vec3(0.2, 0.1, 0.8), // Azul
                                spiral
                            );
                            
                            // Intensidade baseada na distância
                            float intensity = smoothstep(0.2, 0.4, dist) * smoothstep(0.9, 0.7, dist);
                            intensity *= spiral * distortion;
                            
                            color += accretionColor * intensity * 2.0;
                        }
                        
                        // Efeito de lente gravitacional
                        float lensing = 1.0 / (1.0 + dist * 20.0);
                        lensing = pow(lensing, 3.0);
                        
                        // Partículas estelares
                        vec2 starUV = uv * 50.0;
                        float starNoise = noise(starUV + time * 0.1);
                        starNoise = pow(starNoise, 8.0);
                        starNoise *= smoothstep(0.8, 1.0, random(starUV));
                        
                        color += vec3(starNoise * 0.5);
                        
                        // Efeito de brilho central
                        float glow = 1.0 / (1.0 + dist * 30.0);
                        glow = pow(glow, 4.0);
                        color += vec3(0.3, 0.1, 0.5) * glow;
                        
                        // Aplicar distorção final
                        color *= distortion;
                        
                        gl_FragColor = vec4(color, 1.0);
                    }
                `;
                
                // Material do buraco negro
                const blackHoleMaterial = new THREE.ShaderMaterial({
                    vertexShader: blackHoleVertexShader,
                    fragmentShader: blackHoleFragmentShader,
                    uniforms: {
                        time: { value: 0 },
                        uIntensity: { value: 1.0 },
                        uMouse: { value: new THREE.Vector2(0, 0) }
                    }
                });
                
                // Geometria do buraco negro
                const blackHoleGeometry = new THREE.PlaneGeometry(6, 6, 64, 64);
                const blackHole = new THREE.Mesh(blackHoleGeometry, blackHoleMaterial);
                scenes.space.add(blackHole);
                
                // Sistema de partículas estelares
                const starsGeometry = new THREE.BufferGeometry();
                const starsCount = 2000;
                const starsPositions = new Float32Array(starsCount * 3);
                const starsSizes = new Float32Array(starsCount);
                
                for(let i = 0; i < starsCount * 3; i += 3) {
                    const radius = 5 + Math.random() * 15;
                    const angle = Math.random() * Math.PI * 2;
                    
                    starsPositions[i] = Math.cos(angle) * radius;
                    starsPositions[i + 1] = (Math.random() - 0.5) * 10;
                    starsPositions[i + 2] = Math.sin(angle) * radius;
                    
                    starsSizes[i / 3] = Math.random() * 0.1 + 0.05;
                }
                
                starsGeometry.setAttribute('position', new THREE.BufferAttribute(starsPositions, 3));
                starsGeometry.setAttribute('size', new THREE.BufferAttribute(starsSizes, 1));
                
                // Shader para partículas estelares
                const starsVertexShader = `
                    attribute float size;
                    varying float vSize;
                    void main() {
                        vSize = size;
                        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
                        gl_PointSize = size * (300.0 / -mvPosition.z);
                        gl_Position = projectionMatrix * mvPosition;
                    }
                `;
                
                const starsFragmentShader = `
                    varying float vSize;
                    void main() {
                        float alpha = 1.0 - smoothstep(0.0, vSize, length(gl_PointCoord - vec2(0.5)));
                        gl_FragColor = vec4(1.0, 1.0, 1.0, alpha * 0.8);
                    }
                `;
                
                const starsMaterial = new THREE.ShaderMaterial({
                    vertexShader: starsVertexShader,
                    fragmentShader: starsFragmentShader,
                    transparent: true,
                    blending: THREE.AdditiveBlending,
                    depthWrite: false
                });
                
                const stars = new THREE.Points(starsGeometry, starsMaterial);
                scenes.space.add(stars);
                
                // Animação
                let time = 0;
                function animate() {
                    requestAnimationFrame(animate);
                    time += 0.01;
                    
                    // Atualizar uniformes
                    blackHoleMaterial.uniforms.time.value = time;
                    
                    // Rotação das estrelas
                    stars.rotation.y += 0.0005;
                    
                    // Renderizar
                    renderer.render(scenes.space, camera);
                }
                
                animate();
                console.log('Simulação original do buraco negro carregada com sucesso!');
                
                // Responsividade
                window.addEventListener('resize', () => {
                    config.width = window.innerWidth;
                    config.height = window.innerHeight;
                    
                    camera.aspect = config.width / config.height;
                    camera.updateProjectionMatrix();
                    
                    renderer.setSize(config.width, config.height);
                });
                
                // Interação com mouse
                document.addEventListener('mousemove', (event) => {
                    const mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                    const mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
                    blackHoleMaterial.uniforms.uMouse.value.set(mouseX, mouseY);
                });
                
            } catch (error) {
                console.error('Erro ao carregar simulação original:', error);
                document.querySelector('.experience').innerHTML = '<div style="color: white; text-align: center; padding: 50px; font-family: Arial, sans-serif;">Erro ao carregar a simulação original do buraco negro: ' + error.message + '</div>';
            }
        </script>
    </body>
</html>